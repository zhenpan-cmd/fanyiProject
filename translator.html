<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="å³æ—¶ç¿»è¯‘">
    <meta name="format-detection" content="telephone=no">
    <title>å³æ—¶ç¿»è¯‘</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="cet4-theme">
    <div class="container">
        <header>
            <h1>å³æ—¶ç¿»è¯‘</h1>
            <div class="version-info">ç‰ˆæœ¬: v1.6.0</div>
            <div class="back-link">
                <a href="entry.html" class="btn btn-secondary">â† è¿”å›é¦–é¡µ</a>
            </div>
        </header>
        
        <main>
            <div class="translator-section full-width">
                <textarea id="inputText" placeholder="è¾“å…¥ä¸­æ–‡æˆ–è‹±æ–‡..."></textarea>
                <div class="translate-controls">
                    <button id="translateBtn" class="btn btn-primary big-btn">ğŸ” ç«‹å³ç¿»è¯‘</button>
                    <button id="swapBtn" class="btn secondary-btn big-btn">ğŸ”„ äº¤æ¢è¯­è¨€</button>
                </div>
                <div id="translationResult" class="result-box"></div>
            </div>
        </main>
    </div>
    
    <script>
        // æ·»åŠ é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('å…¨å±€é”™è¯¯:', message, source, lineno, colno, error);
        };
    </script>
    
    <script src="data/words.js"></script>
    <script>
        // DOMå…ƒç´ 
        const inputText = document.getElementById('inputText');
        const translateBtn = document.getElementById('translateBtn');
        const swapBtn = document.getElementById('swapBtn');
        const translationResult = document.getElementById('translationResult');

        // ç¿»è¯‘å‡½æ•°
        function translateText(text) {
            // å°è¯•æŸ¥æ‰¾è¯æ±‡åº“ä¸­çš„å•è¯
            const englishWord = lookupEnglishWord(text.trim());
            if (englishWord) {
                return `
                    <div class="translation-details">
                        <div class="word-header">
                            <span class="word">${englishWord.english}</span>
                            <span class="phonetic">/${englishWord.phonetic}/</span>
                        </div>
                        <div class="chinese">${englishWord.chinese}</div>
                        <div class="explanation"><strong>é‡Šä¹‰:</strong> ${englishWord.explanation}</div>
                        <div class="examples">
                            <strong>ä¾‹å¥:</strong><br>
                            ${englishWord.example ? `<div class="example">${englishWord.example}</div><div class="example-chinese">${englishWord.exampleChinese}</div>` : ''}
                            ${englishWord.example2 ? `<div class="example">${englishWord.example2}</div><div class="example-chinese">${englishWord.exampleChinese2 || ''}</div>` : ''}
                            ${englishWord.example3 ? `<div class="example">${englishWord.example3}</div><div class="example-chinese">${englishWord.exampleChinese3 || ''}</div>` : ''}
                        </div>
                        <div class="level">è¯æ±‡çº§åˆ«: ${getLevelName(englishWord.level)}</div>
                    </div>
                `;
            }
            
            const chineseWord = lookupChineseWord(text.trim());
            if (chineseWord) {
                return `
                    <div class="translation-details">
                        <div class="word-header">
                            <span class="word">${chineseWord.english}</span>
                            <span class="phonetic">/${chineseWord.phonetic}/</span>
                        </div>
                        <div class="chinese">${chineseWord.chinese}</div>
                        <div class="explanation"><strong>é‡Šä¹‰:</strong> ${chineseWord.explanation}</div>
                        <div class="examples">
                            <strong>ä¾‹å¥:</strong><br>
                            ${chineseWord.example ? `<div class="example">${chineseWord.example}</div><div class="example-chinese">${chineseWord.exampleChinese}</div>` : ''}
                            ${chineseWord.example2 ? `<div class="example">${chineseWord.example2}</div><div class="example-chinese">${chineseWord.exampleChinese2 || ''}</div>` : ''}
                            ${chineseWord.example3 ? `<div class="example">${chineseWord.example3}</div><div class="example-chinese">${chineseWord.exampleChinese3 || ''}</div>` : ''}
                        </div>
                        <div class="level">è¯æ±‡çº§åˆ«: ${getLevelName(chineseWord.level)}</div>
                    </div>
                `;
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›æç¤ºä¿¡æ¯
            return `æœªèƒ½æ‰¾åˆ°"${text}"çš„ç›¸å…³ä¿¡æ¯ã€‚è¯·å°è¯•å…¶ä»–è¯æ±‡ã€‚`;
        }

        // ç¿»è¯‘åŠŸèƒ½
        function performTranslation() {
            const text = inputText.value.trim();
            if (!text) {
                translationResult.textContent = "è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬";
                return;
            }
            
            const translation = translateText(text);
            translationResult.innerHTML = `<div class="query-section"><strong>æŸ¥è¯¢:</strong> ${text}</div><hr class="divider">${translation}`;
        }

        // äº¤æ¢è¾“å…¥æ¡†å†…å®¹
        function swapLanguages() {
            const currentInput = inputText.value;
            if (currentInput) {
                // ç®€å•åˆ¤æ–­è¯­è¨€å¹¶å°è¯•è½¬æ¢
                if (currentInput.match(/[\u4e00-\u9fa5]/)) {
                    // å¦‚æœè¾“å…¥æ˜¯ä¸­æ–‡ï¼Œå°è¯•æŸ¥æ‰¾è‹±æ–‡
                    const wordInfo = lookupChineseWord(currentInput);
                    if (wordInfo) {
                        inputText.value = wordInfo.english;
                    } else {
                        inputText.value = `æœªæ‰¾åˆ°"${currentInput}"çš„è‹±æ–‡å¯¹åº”è¯`;
                    }
                } else {
                    // å¦‚æœè¾“å…¥æ˜¯è‹±æ–‡ï¼Œå°è¯•æŸ¥æ‰¾ä¸­æ–‡
                    const wordInfo = lookupEnglishWord(currentInput);
                    if (wordInfo) {
                        inputText.value = wordInfo.chinese;
                    } else {
                        inputText.value = `æœªæ‰¾åˆ°"${currentInput}"çš„ä¸­æ–‡ç¿»è¯‘`;
                    }
                }
            }
        }

        // è·å–çº§åˆ«åç§°
        function getLevelName(level) {
            switch(level) {
                case 'cet4': return 'å››çº§';
                case 'cet6': return 'å…­çº§';
                case 'ielts': return 'é›…æ€';
                default: return 'æœªçŸ¥';
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        translateBtn.addEventListener('click', performTranslation);
        swapBtn.addEventListener('click', swapLanguages);

        // å›è½¦é”®ç¿»è¯‘
        inputText.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                performTranslation();
            }
        });

        // å¾®ä¿¡åˆ†äº«åŠŸèƒ½æ”¯æŒ
        function setupWeChatShare() {
            // è¿™é‡Œå¯ä»¥é›†æˆå¾®ä¿¡JS-SDKè¿›è¡Œåˆ†äº«é…ç½®
            // ä»…åœ¨å¾®ä¿¡ç¯å¢ƒä¸­æœ‰æ•ˆ
            if (typeof WeixinJSBridge !== 'undefined') {
                WeixinJSBridge.on('menu:share:appmessage', function(argv) {
                    // åˆ†äº«ç»™æœ‹å‹
                    WeixinJSBridge.invoke('sendAppMessage', {
                        "img_url": "",
                        "img_width": "120",
                        "img_height": "120",
                        "link": window.location.href,
                        "desc": "å³æ—¶ç¿»è¯‘ - å¿«é€ŸæŸ¥æ‰¾å•è¯é‡Šä¹‰å’Œä¾‹å¥",
                        "title": "å³æ—¶ç¿»è¯‘"
                    }, function(res) {
                        // åˆ†äº«å›è°ƒ
                    });
                });
                
                WeixinJSBridge.on('menu:share:timeline', function(argv) {
                    // åˆ†äº«åˆ°æœ‹å‹åœˆ
                    WeixinJSBridge.invoke('shareTimeline', {
                        "img_url": "",
                        "img_width": "120",
                        "img_height": "120",
                        "link": window.location.href,
                        "desc": "å³æ—¶ç¿»è¯‘ - å¿«é€ŸæŸ¥æ‰¾å•è¯é‡Šä¹‰å’Œä¾‹å¥",
                        "title": "å³æ—¶ç¿»è¯‘"
                    }, function(res) {
                        // åˆ†äº«å›è°ƒ
                    });
                });
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupWeChatShare();
            
            // æ·»åŠ ç§»åŠ¨ç«¯è§¦æ‘¸æ”¯æŒ
            [translateBtn, swapBtn].forEach(button => {
                if (button && 'ontouchstart' in window) {
                    button.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    button.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                        // å»¶è¿Ÿæ¢å¤ï¼Œæä¾›æ›´å¥½çš„è§¦æ„Ÿåé¦ˆ
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                    });
                }
            });
        });
    </script>
</body>
</html>